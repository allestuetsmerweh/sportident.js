{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///./src/SiCard.js","webpack:///./src/SiMainStation.js","webpack:///./src/SiStation.js","webpack:///./src/constants.js","webpack:///./src/drivers/BaseDriver.js","webpack:///./src/drivers/WebUsb.js","webpack:///./src/drivers/index.js","webpack:///./src/index.js","webpack:///./src/utils.js"],"names":["SiCard","mainStation","cardNumber","clearTime","checkTime","startTime","finishTime","punches","typeFromCN","typeByCardNumber","Type","read","type","map","punch","code","time","join","toString","replace","SICard5","vals","description","card","_sendCommand","proto","cmd","GET_SI5","then","d","data","splice","cn","console","warn","slice","len","Math","min","max","Array","ind","i","ACK","SICard6","GET_SI6","blk","SICard8","undefined","GET_SI8","data0","assert","page0","data1","page1","SICard9","isLastBlock","SICard10","readSiCard10TimeBlock","blockData","punchData","blockIndex","punchCount","punchesPerBlock","data4","page4","is4LastBlock","data5","page5","is5LastBlock","data6","page6","is6LastBlock","data7","page7","SICard11","readSiCard11TimeBlock","SIAC","readSIACTimeBlock","PCard","_card","TCard","FCard","_typeLookup","borderList","borderLookup","Object","keys","k","length","Error","lastEvenVal","j","borderExisted","collidingRange","SendTask","command","parameters","numResponses","resolve","reject","timeout","state","State","QUEUED","timeoutTimer","setTimeout","SENT","debug","responses","fail","response","push","succeed","SUCCEEDED","clearTimeout","FAILED","SiMainStation","device","Closed","onMessage","onRemoved","onStateChanged","onCardInserted","onCard","onCardRemoved","_sendQueue","_respBuffer","_deviceOpenTimer","_deviceOpenNumErrors","allByDevice","ident","onAdded","err","_deviceOpen","f","args","newState","_changeState","Opening","driver","open","Starting","GET_MS","Ready","catch","error","_retryDeviceOpen","scheduleReopen","close","bufView","name","continueProcessing","_processReceiveBuffer","message","_dispatch","mode","NAK","SI5_DET","log","SI6_DET","SI8_DET","SI_REM","TRANS_REC","transRecordCard","addResponse","_processSendQueue","sendTask","bstr","String","fromCharCode","WAKEUP","bytes","Uint8Array","charCodeAt","send","buffer","numRespArg","timeoutArg","Promise","resolvedTask","shifted","shift","rejectedTask","SiStation","drivers","all","arr","deviceIdent","startDeviceDetection","runDeviceDetection","detect","detectionTimeout","newDevice","new","_ms","_info","_infoTime","_infoSubscribers","now","Date","getTime","forceReadInfo","GET_SYS_VAL","_raw","refreshRate","powerMode","interval","wtf","program","handshake","sprint4ms","passwordOnly","stopOnFullBackup","autoReadout","infoSubscriber","_err","newTime","GET_TIME","params","SET_TIME","countArg","count","SIGNAL","OFF","retrieveFunc","paramsFunc","newValue","readInfo","info","SET_SYS_VAL","newCode","newMode","constructor","modeByValue","newModeVal","hasOwnProperty","val","newBeeps","newFlashes","newAutoSend","newExtendedProtocol","modelByValue","concat","Mode","value","Model","SIACSpecialFunction1","Control","Start","Finish","Readout","Clear","Check","Print","StartWithTimeTrigger","FinishWithTimeTrigger","BCControl","BCStart","BCFinish","BCSlave","Main","Sprint","Field","Master","BSF3","series","BSF4","BSF5","BSF6","BSF7","BSF8","BS7Master","BS8Master","BSM4","BSM6","BSM7","BSM8","BS7S","BS7P","BS7GSM","BS8P","STX","ETX","DLE","basicCmd","SET_CARDNO","SI5_WRITE","TRANS_TIME","SET_MS","GET_BDATA","ERASE_BDATA","GET_BDATA2","SET_BAUD","basicCmdLookup","GET_BACKUP","SRR_WRITE","SRR_READ","SRR_QUERY","SRR_PING","SRR_ADHOC","CLEAR_CARD","SET_SI6","SET_SI6_SPECIAL","SET_SI8","cmdLookup","P_MS_DIRECT","P_MS_INDIRECT","P_SI6_CB","sysDataOffset","OLD_SERIAL","OLD_CPU_ID","SERIAL_NO","FIRMWARE","BUILD_DATE","MODEL_ID","MEM_SIZE","REFRESH_RATE","POWER_MODE","BAT_DATE","BAT_CAP","BACKUP_PTR","SI6_CB","BAT_STATE","MEM_OVERFLOW","INTERVAL","WTF","PROGRAM","MODE","STATION_CODE","PROTO","LAST_WRITE_DATE","LAST_WRITE_TIME","SLEEP_TIME","WORKING_TIME","M_CONTROL","M_START","M_FINISH","M_READ_SICARDS","M_CLEAR","M_CHECK","M_PRINTOUT","D_SUNDAY","D_MONDAY","D_TUESDAY","D_WEDNESDAY","D_THURSDAY","D_FRIDAY","D_SATURDAY","REC_LEN","T_OFFSET","T_CN","T_TIME","BC_CN","BC_TIME","BaseDriver","_MainStation","_mainStation","_buffer","siConfiguration","siInterface","siAlternate","siEndpoint","siPacketSize","siDeviceFilters","vendorId","productId","WebUsb","MainStation","navigator","usb","requestDevice","filters","selectedDevice","serialNumber","productName","_device","getDevices","devices","matchesSiDeviceFilter","findIndex","filter","_reject","dev","_receiveLoop","transferIn","_logReceive","_remove","reset","selectConfiguration","claimInterface","selectAlternateInterface","controlTransferOut","requestType","recipient","request","index","releaseInterface","transferOut","default","constants","utils","si","Station","Card","onLoad","window","addEventListener","iterable2arr","iterable","call","isByte","byte","Number","floor","isByteArr","isArray","e","assertIsByteArr","isArrOfLengths","lengths","actualLength","assertArrIsOfLengths","arr2big","outnum","pow","arr2time","arr2date","asOf","maxYear","getUTCFullYear","getYear","lastTwoDigits","maxLastTwo","maxRest","utcYear","utcMonth","utcDate","secs","utcHours","utcMinutes","utcSeconds","utcMilliseconds","date","UTC","isValidDate","getUTCMonth","getUTCDate","getUTCHours","getUTCMinutes","getUTCSeconds","getUTCMilliseconds","date2arr","dateTime","getUTCDay","arr2cardNumber","cardnum","fourthSet","prettyHex","input","lineLength","strIndex","prettyBytes","paddedStr","toUpperCase","lines","lineIndex","startIndex","endIndex","line","prettyMessage","prettyCommand","prettyParameters","JSON","stringify","unPrettyHex","hexString","byteArray","byteIndex","byteValue","parseInt","substr","CRC16","str","CRC_POLYNOM","CRC_BITF","s","crc","c","getLookup","mapping","getLookupKeys","_lookup","mappingKey","forEach","lookupKey","processSiProto","inputData","crcContent","buildSiProtoCommand","commandString","timeoutResolvePromise","timeoutRejectPromise","reason"],"mappings":"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","file":"si.min.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"/assets/\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = \"./src/index.js\");\n","import {arr2big, arr2time} from './utils';\nimport {proto} from './constants';\n\nexport class SiCard {\n    constructor(mainStation, cardNumber) {\n        this.mainStation = mainStation;\n        this.cardNumber = cardNumber;\n        this.clearTime = -1;\n        this.checkTime = -1;\n        this.startTime = -1;\n        this.finishTime = -1;\n        this.punches = [];\n    }\n\n    read() {\n        var typeFromCN = SiCard.typeByCardNumber(this.cardNumber);\n        return SiCard.Type[typeFromCN].read(this);\n    }\n\n    type() {\n        return SiCard.typeByCardNumber(this.cardNumber);\n    }\n\n    toDict() {\n        return {\n            cardNumber: this.cardNumber,\n            clearTime: this.clearTime,\n            checkTime: this.checkTime,\n            startTime: this.startTime,\n            finishTime: this.finishTime,\n            punches: this.punches,\n        };\n    }\n\n    toString() {\n        return `${this.type()} Number: ${this.cardNumber}\nClear: ${this.clearTime}\nCheck: ${this.checkTime}\nStart: ${this.startTime}\nFinish: ${this.finishTime}\n${this.punches.map((punch) => `${punch.code}: ${punch.time}`).join('\\n')}\n`;\n    }\n\n    toHtml() {\n        return this.toString().replace(/\\n/g, '<br />');\n    }\n}\nSiCard.Type = {\n    SICard5: {\n        vals: [1000, 500000],\n        description: 'SI Card 5',\n        read: (card) => card.mainStation._sendCommand(proto.cmd.GET_SI5, [], 1)\n            .then((d) => {\n                const data = d[0];\n                data.splice(0, 2);\n                var cn = arr2big([data[6], data[4], data[5]]);\n                if (499999 < cn) { console.warn(`SICard5 Error: SI Card Number inconsistency: SI5 detected, but number is ${cn} (not in 0 - 500'000)`); }\n                if (data[6] < 2) {\n                    cn = arr2big([data[4], data[5]]);\n                } else {\n                    cn = data[6] * 100000 + arr2big([data[4], data[5]]);\n                }\n                if (card.cardNumber !== cn) { console.warn('SICard5 Error: SI Card Number inconsistency'); }\n\n                card.startTime = arr2time(data.slice(19, 21));\n                card.finishTime = arr2time(data.slice(21, 23));\n                card.checkTime = arr2time(data.slice(25, 27));\n                // TODO: also read the 6(?) additional punch codes without times\n                var len = Math.min(Math.max(data[23] - 1, 0), 30);\n                card.punches = new Array(len);\n                var ind = 32;\n                for (var i = 0; i < len; i++) {\n                    if ((ind % 16) === 0) {\n                        ind++;\n                    }\n                    var time = arr2time(data.slice(ind + 1, ind + 3));\n                    if (0 <= time) {\n                        card.punches[i] = {code: data[ind + 0], time: time};\n                    } else {\n                        console.warn('SICard5 Error: Undefined Time in punched range');\n                    }\n                    ind += 3;\n                }\n                card.mainStation._sendCommand(proto.ACK, [], 0);\n                return card;\n            }),\n    },\n    SICard6: {\n        vals: [500000, 1000000, 2003000, 2004000],\n        description: 'SI Card 6',\n        read: (card) => card.mainStation._sendCommand(proto.cmd.GET_SI6, [0x08], 3)\n            .then((data) => {\n                if (data[0][2] !== 0) { console.warn(`SICard6 Error: First read block is ${data[0][2]} (expected 0)`); }\n                if (data[1][2] !== 6) { console.warn(`SICard6 Error: Second read block is ${data[1][2]} (expected 6)`); }\n                if (data[2][2] !== 7) { console.warn(`SICard6 Error: Third read block is ${data[2][2]} (expected 7)`); }\n                data[0].splice(0, 3);\n                data[1].splice(0, 3);\n                data[2].splice(0, 3);\n                var cn = arr2big([data[0][11], data[0][12], data[0][13]]);\n                if (card.cardNumber !== cn) { console.warn('SICard6 Error: SI Card Number inconsistency'); }\n\n                card.startTime = arr2time(data[0].slice(26, 28));\n                card.finishTime = arr2time(data[0].slice(22, 24));\n                card.checkTime = arr2time(data[0].slice(30, 32));\n                card.clearTime = arr2time(data[0].slice(34, 36));\n                var len = Math.min(Math.max(data[0][18] - 1, 0), 64);\n                card.punches = new Array(len);\n                var blk = 1;\n                var ind = 0;\n                for (var i = 0; i < len; i++) {\n                    if (128 <= ind) {\n                        blk++;\n                        ind = 0;\n                    }\n                    var time = arr2time(data[blk].slice(ind + 2, ind + 4));\n                    if (0 <= time) {\n                        card.punches[i] = {code: data[blk][ind + 1], time: time};\n                    } else {\n                        console.warn('SICard6 Error: Undefined Time in punched range');\n                    }\n                    ind += 4;\n                }\n                card.mainStation._sendCommand(proto.ACK, [], 0);\n                return card;\n            }),\n    },\n    SICard8: {\n        vals: [2000000, 2003000, 2004000, 3000000],\n        description: 'SI Card 8',\n        read: (card) => {\n            let len = undefined;\n            return card.mainStation._sendCommand(proto.cmd.GET_SI8, [0x00], 1)\n                .then((data0) => {\n                    console.assert(data0[0][2] === 0, 'Inconsistent');\n                    const page0 = data0[0].slice(3);\n                    var cn = arr2big([page0[25], page0[26], page0[27]]);\n                    if (card.cardNumber !== cn) {\n                        console.warn('SICard8 Error: SI Card Number inconsistency');\n                    }\n\n                    card.startTime = arr2time(page0.slice(14, 16));\n                    card.finishTime = arr2time(page0.slice(18, 20));\n                    card.checkTime = arr2time(page0.slice(10, 12));\n                    len = Math.min(Math.max(page0[22], 0), 128);\n                    card.punches = new Array(len);\n\n                    return card.mainStation._sendCommand(proto.cmd.GET_SI8, [0x01], 1);\n                })\n                .then((data1) => {\n                    console.assert(data1[0][2] === 1, 'Inconsistent');\n                    const page1 = data1[0].slice(3);\n                    for (let i = 0; i < 30; i++) {\n                        if (i >= len) {\n                            break;\n                        }\n                        var time = arr2time(page1.slice(i * 4 + 10, i * 4 + 12));\n                        if (0 <= time) {\n                            card.punches[i] = {\n                                code: page1[i * 4 + 9],\n                                time: time,\n                            };\n                        } else {\n                            console.warn('SICard8 Error: Undefined Time in punched range');\n                        }\n                    }\n                    return card.mainStation._sendCommand(proto.ACK, [], 0).then(() => card);\n                });\n        },\n    },\n    SICard9: {\n        vals: [1000000, 2000000],\n        description: 'SI Card 9',\n        read: (card) => {\n            let len = undefined;\n            return card.mainStation._sendCommand(proto.cmd.GET_SI8, [0x00], 1)\n                .then((data0) => {\n                    console.assert(data0[0][2] === 0, 'Inconsistent');\n                    const page0 = data0[0].slice(3);\n                    var cn = arr2big([page0[25], page0[26], page0[27]]);\n                    if (card.cardNumber !== cn) {\n                        console.warn('SICard9 Error: SI Card Number inconsistency');\n                    }\n\n                    card.startTime = arr2time(page0.slice(14, 16));\n                    card.finishTime = arr2time(page0.slice(18, 20));\n                    card.checkTime = arr2time(page0.slice(10, 12));\n                    len = Math.min(Math.max(page0[22], 0), 128);\n                    card.punches = new Array(len);\n\n                    let isLastBlock = false;\n                    for (let i = 0; i < 18; i++) {\n                        if (i >= len) {\n                            isLastBlock = true;\n                            break;\n                        }\n                        const time = arr2time(page0.slice(i * 4 + 58, i * 4 + 60));\n                        if (0 <= time) {\n                            card.punches[i] = {\n                                code: page0[i * 4 + 57],\n                                time: time,\n                            };\n                        } else {\n                            console.warn('SICard9 Error: Undefined Time in punched range');\n                        }\n                    }\n                    if (isLastBlock) {\n                        return card.mainStation._sendCommand(proto.ACK, [], 0).then(() => card);\n                    }\n\n                    return card.mainStation._sendCommand(proto.cmd.GET_SI8, [0x01], 1).then((data1) => {\n                        console.assert(data1[0][2] === 1, 'Inconsistent');\n                        const page1 = data1[0].slice(3);\n                        for (let i = 18; i < 50; i++) {\n                            if (i >= len) {\n                                break;\n                            }\n                            const time = arr2time(page1.slice(i * 4 - 70, i * 4 - 68));\n                            if (0 <= time) {\n                                card.punches[i] = {\n                                    code: page1[i * 4 - 71],\n                                    time: time,\n                                };\n                            } else {\n                                console.warn('SICard9 Error: Undefined Time in punched range');\n                            }\n                        }\n                        return card.mainStation._sendCommand(proto.ACK, [], 0).then(() => card);\n                    });\n                });\n        },\n    },\n    SICard10: {\n        vals: [7000000, 8000000],\n        description: 'SI Card 10',\n        read: (card) => {\n            const readSiCard10TimeBlock = (blockData, punchData, blockIndex, punchCount) => {\n                let isLastBlock = false;\n                const punchesPerBlock = 32;\n                for (let i = 0; i < punchesPerBlock; i++) {\n                    if (blockIndex * punchesPerBlock + i >= punchCount) {\n                        isLastBlock = true;\n                        break;\n                    }\n                    var time = arr2time(blockData.slice(i * 4 + 2, i * 4 + 4));\n                    if (0 <= time) {\n                        punchData[blockIndex * punchesPerBlock + i] = {\n                            code: blockData[i * 4 + 1],\n                            time: time,\n                        };\n                    } else {\n                        console.warn('SICard10 Error: Undefined Time in punched range');\n                    }\n                }\n                return isLastBlock;\n            };\n            let len = undefined;\n            return card.mainStation._sendCommand(proto.cmd.GET_SI8, [0x00], 1)\n                .then((data0) => {\n                    console.assert(data0[0][2] === 0, 'Inconsistent');\n                    const page0 = data0[0].slice(3);\n                    var cn = arr2big([page0[25], page0[26], page0[27]]);\n                    if (card.cardNumber !== cn) {\n                        console.warn('SICard10 Error: SI Card Number inconsistency');\n                    }\n\n                    card.startTime = arr2time(page0.slice(14, 16));\n                    card.finishTime = arr2time(page0.slice(18, 20));\n                    card.checkTime = arr2time(page0.slice(10, 12));\n                    len = Math.min(Math.max(page0[22], 0), 128);\n                    card.punches = new Array(len);\n\n                    return card.mainStation._sendCommand(proto.cmd.GET_SI8, [0x04], 1);\n                })\n                .then((data4) => {\n                    console.assert(data4[0][2] === 4, 'Inconsistent');\n                    const page4 = data4[0].slice(3);\n                    const is4LastBlock = readSiCard10TimeBlock(page4, card.punches, 0, len);\n                    if (is4LastBlock) {\n                        return card.mainStation._sendCommand(proto.ACK, [], 0).then(() => card);\n                    }\n                    return card.mainStation._sendCommand(proto.cmd.GET_SI8, [0x05], 1).then((data5) => {\n                        console.assert(data5[0][2] === 5, 'Inconsistent');\n                        const page5 = data5[0].slice(3);\n                        const is5LastBlock = readSiCard10TimeBlock(page5, card.punches, 1, len);\n                        if (is5LastBlock) {\n                            return card.mainStation._sendCommand(proto.ACK, [], 0).then(() => card);\n                        }\n                        return card.mainStation._sendCommand(proto.cmd.GET_SI8, [0x06], 1).then((data6) => {\n                            console.assert(data6[0][2] === 6, 'Inconsistent');\n                            const page6 = data6[0].slice(3);\n                            const is6LastBlock = readSiCard10TimeBlock(page6, card.punches, 2, len);\n                            if (is6LastBlock) {\n                                return card.mainStation._sendCommand(proto.ACK, [], 0).then(() => card);\n                            }\n                            return card.mainStation._sendCommand(proto.cmd.GET_SI8, [0x07], 1).then((data7) => {\n                                console.assert(data7[0][2] === 7, 'Inconsistent');\n                                const page7 = data7[0].slice(3);\n                                readSiCard10TimeBlock(page7, card.punches, 3, len);\n                                return card.mainStation._sendCommand(proto.ACK, [], 0).then(() => card);\n                            });\n                        });\n                    });\n                });\n        },\n    },\n    SICard11: {\n        vals: [9000000, 10000000],\n        description: 'SI Card 11',\n        read: (card) => {\n            const readSiCard11TimeBlock = (blockData, punchData, blockIndex, punchCount) => {\n                let isLastBlock = false;\n                const punchesPerBlock = 32;\n                for (let i = 0; i < punchesPerBlock; i++) {\n                    if (blockIndex * punchesPerBlock + i >= punchCount) {\n                        isLastBlock = true;\n                        break;\n                    }\n                    var time = arr2time(blockData.slice(i * 4 + 2, i * 4 + 4));\n                    if (0 <= time) {\n                        punchData[blockIndex * punchesPerBlock + i] = {\n                            code: blockData[i * 4 + 1],\n                            time: time,\n                        };\n                    } else {\n                        console.warn('SICard11 Error: Undefined Time in punched range');\n                    }\n                }\n                return isLastBlock;\n            };\n            let len = undefined;\n            return card.mainStation._sendCommand(proto.cmd.GET_SI8, [0x00], 1)\n                .then((data0) => {\n                    console.assert(data0[0][2] === 0, 'Inconsistent');\n                    const page0 = data0[0].slice(3);\n                    var cn = arr2big([page0[25], page0[26], page0[27]]);\n                    if (card.cardNumber !== cn) {\n                        console.warn('SICard11 Error: SI Card Number inconsistency');\n                    }\n\n                    card.startTime = arr2time(page0.slice(14, 16));\n                    card.finishTime = arr2time(page0.slice(18, 20));\n                    card.checkTime = arr2time(page0.slice(10, 12));\n                    len = Math.min(Math.max(page0[22], 0), 128);\n                    card.punches = new Array(len);\n\n                    return card.mainStation._sendCommand(proto.cmd.GET_SI8, [0x04], 1);\n                })\n                .then((data4) => {\n                    console.assert(data4[0][2] === 4, 'Inconsistent');\n                    const page4 = data4[0].slice(3);\n                    const is4LastBlock = readSiCard11TimeBlock(page4, card.punches, 0, len);\n                    if (is4LastBlock) {\n                        return card.mainStation._sendCommand(proto.ACK, [], 0).then(() => card);\n                    }\n                    return card.mainStation._sendCommand(proto.cmd.GET_SI8, [0x05], 1).then((data5) => {\n                        console.assert(data5[0][2] === 5, 'Inconsistent');\n                        const page5 = data5[0].slice(3);\n                        const is5LastBlock = readSiCard11TimeBlock(page5, card.punches, 1, len);\n                        if (is5LastBlock) {\n                            return card.mainStation._sendCommand(proto.ACK, [], 0).then(() => card);\n                        }\n                        return card.mainStation._sendCommand(proto.cmd.GET_SI8, [0x06], 1).then((data6) => {\n                            console.assert(data6[0][2] === 6, 'Inconsistent');\n                            const page6 = data6[0].slice(3);\n                            const is6LastBlock = readSiCard11TimeBlock(page6, card.punches, 2, len);\n                            if (is6LastBlock) {\n                                return card.mainStation._sendCommand(proto.ACK, [], 0).then(() => card);\n                            }\n                            return card.mainStation._sendCommand(proto.cmd.GET_SI8, [0x07], 1).then((data7) => {\n                                console.assert(data7[0][2] === 7, 'Inconsistent');\n                                const page7 = data7[0].slice(3);\n                                readSiCard11TimeBlock(page7, card.punches, 3, len);\n                                return card.mainStation._sendCommand(proto.ACK, [], 0).then(() => card);\n                            });\n                        });\n                    });\n                });\n        },\n    },\n    SIAC: {\n        vals: [8000000, 9000000],\n        description: 'SIAC',\n        read: (card) => {\n            const readSIACTimeBlock = (blockData, punchData, blockIndex, punchCount) => {\n                let isLastBlock = false;\n                const punchesPerBlock = 32;\n                for (let i = 0; i < punchesPerBlock; i++) {\n                    if (blockIndex * punchesPerBlock + i >= punchCount) {\n                        isLastBlock = true;\n                        break;\n                    }\n                    var time = arr2time(blockData.slice(i * 4 + 2, i * 4 + 4));\n                    if (0 <= time) {\n                        punchData[blockIndex * punchesPerBlock + i] = {\n                            code: blockData[i * 4 + 1],\n                            time: time,\n                        };\n                    } else {\n                        console.warn('SIAC Error: Undefined Time in punched range');\n                    }\n                }\n                return isLastBlock;\n            };\n            let len = undefined;\n            return card.mainStation._sendCommand(proto.cmd.GET_SI8, [0x00], 1)\n                .then((data0) => {\n                    console.assert(data0[0][2] === 0, 'Inconsistent');\n                    const page0 = data0[0].slice(3);\n                    var cn = arr2big([page0[25], page0[26], page0[27]]);\n                    if (card.cardNumber !== cn) {\n                        console.warn('SIAC Error: SI Card Number inconsistency');\n                    }\n\n                    card.startTime = arr2time(page0.slice(14, 16));\n                    card.finishTime = arr2time(page0.slice(18, 20));\n                    card.checkTime = arr2time(page0.slice(10, 12));\n                    len = Math.min(Math.max(page0[22], 0), 128);\n                    card.punches = new Array(len);\n\n                    return card.mainStation._sendCommand(proto.cmd.GET_SI8, [0x04], 1);\n                })\n                .then((data4) => {\n                    console.assert(data4[0][2] === 4, 'Inconsistent');\n                    const page4 = data4[0].slice(3);\n                    const is4LastBlock = readSIACTimeBlock(page4, card.punches, 0, len);\n                    if (is4LastBlock) {\n                        return card.mainStation._sendCommand(proto.ACK, [], 0).then(() => card);\n                    }\n                    return card.mainStation._sendCommand(proto.cmd.GET_SI8, [0x05], 1).then((data5) => {\n                        console.assert(data5[0][2] === 5, 'Inconsistent');\n                        const page5 = data5[0].slice(3);\n                        const is5LastBlock = readSIACTimeBlock(page5, card.punches, 1, len);\n                        if (is5LastBlock) {\n                            return card.mainStation._sendCommand(proto.ACK, [], 0).then(() => card);\n                        }\n                        return card.mainStation._sendCommand(proto.cmd.GET_SI8, [0x06], 1).then((data6) => {\n                            console.assert(data6[0][2] === 6, 'Inconsistent');\n                            const page6 = data6[0].slice(3);\n                            const is6LastBlock = readSIACTimeBlock(page6, card.punches, 2, len);\n                            if (is6LastBlock) {\n                                return card.mainStation._sendCommand(proto.ACK, [], 0).then(() => card);\n                            }\n                            return card.mainStation._sendCommand(proto.cmd.GET_SI8, [0x07], 1).then((data7) => {\n                                console.assert(data7[0][2] === 7, 'Inconsistent');\n                                const page7 = data7[0].slice(3);\n                                readSIACTimeBlock(page7, card.punches, 3, len);\n                                return card.mainStation._sendCommand(proto.ACK, [], 0).then(() => card);\n                            });\n                        });\n                    });\n                });\n        },\n    },\n    PCard: {vals: [4000000, 5000000], description: 'pCard', read: (_card) => undefined},\n    TCard: {vals: [6000000, 7000000], description: 'tCard', read: (_card) => undefined},\n    FCard: {vals: [14000000, 15000000], description: 'fCard', read: (_card) => undefined},\n};\n\nSiCard.typeByCardNumber = (cn) => {\n    if (!SiCard._typeLookup) {\n        SiCard._typeLookup = {borderList: [], borderLookup: {}};\n        Object.keys(SiCard.Type).map((k) => {\n            var vals = SiCard.Type[k].vals;\n            if ((vals.length % 2) !== 0) {\n                throw new Error(`SiCard.Type.${k}: vals length is ${vals.length}?!? (must be even)`);\n            }\n            var lastEvenVal = 0;\n            for (var i = 0; i < vals.length; i++) {\n                var borderList = SiCard._typeLookup.borderList;\n                let j;\n                for (j = 0; j < borderList.length && borderList[j] < vals[i]; j++) {\n                    // TODO: binary search here\n                }\n                var borderExisted = (SiCard._typeLookup.borderList[j] === vals[i]);\n                if (!borderExisted) { SiCard._typeLookup.borderList.splice(j, 0, vals[i]); }\n                if ((i % 2) === 0) {\n                    let collidingRange;\n                    if (borderExisted) {\n                        collidingRange = SiCard._typeLookup.borderLookup[vals[i]];\n                        if (collidingRange) {\n                            throw new Error(`SiCard.Type.${k}: ${vals[i]} would collide with ${collidingRange}`);\n                        }\n                    }\n                    if (!borderExisted && 0 < j) {\n                        collidingRange = SiCard._typeLookup.borderLookup[SiCard._typeLookup.borderList[j - 1]];\n                        if (collidingRange) {\n                            throw new Error(`SiCard.Type.${k}: ${vals[i]} would collide with ${collidingRange}`);\n                        }\n                    }\n                    SiCard._typeLookup.borderLookup[vals[i]] = k;\n                    lastEvenVal = vals[i];\n                } else {\n                    if (lastEvenVal !== SiCard._typeLookup.borderList[j - 1]) {\n                        throw new Error(`SiCard.Type.${k}: ${vals[i]} is not an immediate follow-up of ${lastEvenVal}`);\n                    }\n                    if (!SiCard._typeLookup.borderLookup[vals[i]]) { SiCard._typeLookup.borderLookup[vals[i]] = false; }\n                }\n            }\n        });\n    }\n    let j;\n    for (j = 0; j < SiCard._typeLookup.borderList.length && SiCard._typeLookup.borderList[j] <= cn; j++) {\n        // TODO: binary search here\n    }\n    if (j === 0) { return false; }\n    return SiCard._typeLookup.borderLookup[SiCard._typeLookup.borderList[j - 1]];\n};\n","import {arr2big, arr2cardNumber, prettyHex, processSiProto, buildSiProtoCommand} from './utils';\nimport {proto} from './constants';\nimport {SiCard} from './SiCard';\nimport {SiStation} from './SiStation';\n\nclass SendTask {\n    constructor(\n        command,\n        parameters,\n        numResponses,\n        resolve,\n        reject,\n        timeout,\n    ) {\n        this.command = command;\n        this.parameters = parameters;\n        this.numResponses = numResponses;\n        this.resolve = resolve;\n        this.reject = reject;\n        this.timeout = timeout;\n        this.state = SendTask.State.QUEUED;\n        this.timeoutTimer = setTimeout(() => {\n            if (this.state !== SendTask.State.SENT) {\n                return;\n            }\n            console.debug(`Timeout: cmd ${prettyHex([this.command])} (expected ${this.numResponses} responses)`, this.responses);\n            this.fail();\n        }, timeout * 1000);\n        this.responses = [];\n    }\n\n    addResponse(response) {\n        this.responses.push(response);\n        if (this.responses.length === this.numResponses) {\n            this.succeed();\n        }\n    }\n\n    succeed() {\n        this.state = SendTask.State.SUCCEEDED;\n        clearTimeout(this.timeoutTimer);\n        this.resolve(this);\n    }\n\n    fail() {\n        this.state = SendTask.State.FAILED;\n        clearTimeout(this.timeoutTimer);\n        this.reject(this);\n    }\n}\n\nSendTask.State = {\n    QUEUED: 0,\n    SENT: 1,\n    SUCCEEDED: 2,\n    FAILED: 3,\n};\n\nexport class SiMainStation extends SiStation {\n    constructor(device, state = SiMainStation.State.Closed) {\n        super(null);\n        this.mainStation = this;\n        this.device = device;\n        this.card = false;\n        this.onMessage = false;\n        this.onRemoved = false;\n        this.onStateChanged = false;\n        this.onCardInserted = false;\n        this.onCard = false;\n        this.onCardRemoved = false;\n        this._sendQueue = [];\n        this._respBuffer = [];\n        this._deviceOpenTimer = false;\n        this._deviceOpenNumErrors = 0;\n        this.state = state;\n        if (!SiMainStation.allByDevice[device.ident]) {\n            SiMainStation.allByDevice[device.ident] = this;\n            try {\n                SiMainStation.onAdded(this);\n            } catch (err) {\n                // ignore\n            }\n        }\n        if (this.state === SiMainStation.State.Closed) {\n            this._deviceOpen();\n        }\n    }\n\n    resetCardCallbacks() {\n        this.onCardInserted = false;\n        this.onCard = false;\n        this.onCardRemoved = false;\n    }\n\n    _dispatch(f, args) {\n        if (f) {\n            setTimeout(() => f(...args), 1);\n        }\n    }\n\n    _changeState(newState) {\n        this.state = newState;\n        if (this.onStateChanged) {\n            this.onStateChanged(this.state);\n        }\n    }\n\n    _deviceOpen() {\n        this._changeState(SiMainStation.State.Opening);\n        this.device.driver.open(this)\n            .then(() => {\n                this._changeState(SiMainStation.State.Starting);\n                this._deviceOpenNumErrors = 0;\n                this._sendCommand(proto.cmd.GET_MS, [0x00], 1, 5)\n                    .then(() => {\n                        this._changeState(SiMainStation.State.Ready);\n                    })\n                    .catch((err) => {\n                        this._changeState(SiMainStation.State.Closed);\n                        console.error('Could not communicate after having opened SiMainStation: ', err);\n                        this._retryDeviceOpen();\n                    });\n            })\n            .catch((err) => {\n                console.error('Could not open SiMainStation: ', err);\n                this._retryDeviceOpen();\n            });\n    }\n\n    _retryDeviceOpen() {\n        var scheduleReopen = () => {\n            if (!this._deviceOpenTimer) {\n                var timeout = 100;\n                for (var i = 0; i < this._deviceOpenNumErrors && i < 10; i++) { timeout = timeout * 2; }\n                this._deviceOpenTimer = setTimeout(() => {\n                    this._deviceOpenTimer = false;\n                    this._deviceOpen();\n                }, timeout);\n                this._deviceOpenNumErrors++;\n            }\n        };\n        this.device.driver.close(this)\n            .then(() => {\n                scheduleReopen();\n            })\n            .catch((err) => {\n                console.error('Could not close device: ', err);\n                scheduleReopen();\n            });\n    }\n\n    _logReceive(bufView) {\n        console.debug(`<= (${this.device.driver.name}; ${this._respBuffer.length})\\n${prettyHex(bufView, 16)}`);\n    }\n\n    _processReceiveBuffer() {\n        const continueProcessing = (timeout = 1) => setTimeout(() => this._processReceiveBuffer(), timeout);\n        const message = processSiProto(this._respBuffer);\n        if (message === null) {\n            return null;\n        }\n        if (this.onMessage) {\n            this._dispatch(this.onMessage, [message]);\n            return continueProcessing();\n        }\n        const {mode, command, parameters} = message;\n        if (mode === proto.NAK) {\n            if (0 < this._sendQueue.length && this._sendQueue[0].state === SendTask.State.SENT) {\n                this._sendQueue[0].fail();\n            }\n            return continueProcessing();\n        }\n        let cn, typeFromCN;\n        if (command === proto.cmd.SI5_DET) {\n            cn = arr2cardNumber([parameters[5], parameters[4], parameters[3]]);\n            this.card = new SiCard(this, cn);\n            console.log('SI5 DET', this.card, parameters);\n            this._dispatch(this.onCardInserted, [this.card]);\n            this.card.read()\n                .then((card) => {\n                    this._dispatch(this.onCard, [card]);\n                });\n            return continueProcessing();\n        }\n        if (command === proto.cmd.SI6_DET) {\n            cn = arr2cardNumber([parameters[5], parameters[4], parameters[3]]);\n            typeFromCN = SiCard.typeByCardNumber(cn);\n            if (typeFromCN !== 'SICard6') {\n                console.warn(`SICard6 Error: SI Card Number inconsistency: Function SI6 called, but number is ${cn} (=> ${typeFromCN})`);\n            }\n            this.card = new SiCard(this, cn);\n            console.log('SI6 DET', parameters);\n            this._dispatch(this.onCardInserted, [this.card]);\n            this.card.read()\n                .then((card) => {\n                    this._dispatch(this.onCard, [card]);\n                });\n            return continueProcessing();\n        }\n        if (command === proto.cmd.SI8_DET) {\n            cn = arr2cardNumber([parameters[5], parameters[4], parameters[3]]);\n            typeFromCN = SiCard.typeByCardNumber(cn);\n            if (!{'SICard8': 1, 'SICard9': 1, 'SICard10': 1, 'SICard11': 1}[typeFromCN]) {\n                console.warn(`SICard8 Error: SI Card Number inconsistency: Function SI8 called, but number is ${cn} (=> ${typeFromCN})`);\n            }\n            this.card = new SiCard(this, cn);\n            console.log('SI8 DET', parameters);\n            this._dispatch(this.onCardInserted, [this.card]);\n            this.card.read()\n                .then((card) => {\n                    this._dispatch(this.onCard, [card]);\n                });\n            return continueProcessing();\n        }\n        if (command === proto.cmd.SI_REM) {\n            cn = arr2cardNumber([parameters[5], parameters[4], parameters[3]]);\n            console.log('SI REM', parameters, cn, this.card);\n            if (this.card !== false && this.card.cardNumber === cn) {\n                this._dispatch(this.onCardRemoved, [this.card]);\n            } else {\n                console.warn(`Card ${cn} was removed, but never inserted`);\n            }\n            this.card = false;\n            if (\n                this._sendQueue.length > 0 &&\n                this._sendQueue[0].state === SendTask.State.SENT &&\n                0xB0 <= this._sendQueue[0].command &&\n                this._sendQueue[0].command <= 0xEF\n            ) { // Was expecting response from card => \"early Timeout\"\n                console.debug(`Early Timeout: cmd ${prettyHex([this._sendQueue[0].command])} (expected ${this._sendQueue[0].numResponses} responses)`, this._sendQueue[0].responses);\n                this._sendQueue[0].fail();\n            }\n            return continueProcessing();\n        }\n        if (command === proto.cmd.TRANS_REC) {\n            cn = arr2big([parameters[3], parameters[4], parameters[5]]);\n            if (cn < 500000) {\n                if (parameters[3] < 2) {\n                    cn = arr2big([parameters[4], parameters[5]]);\n                } else {\n                    cn = parameters[3] * 100000 + arr2big([parameters[4], parameters[5]]);\n                }\n            }\n            const transRecordCard = new SiCard(this, cn);\n            console.log('TRANS_REC', transRecordCard, parameters);\n            this._dispatch(this.onCardInserted, [transRecordCard]);\n            this._dispatch(this.onCardRemoved, [transRecordCard]);\n            return continueProcessing();\n        }\n        if (this._sendQueue.length === 0 || this._sendQueue[0].state !== SendTask.State.SENT) {\n            console.warn(`Strange Response: ${prettyHex([command])} (not expecting anything)...`);\n            return continueProcessing();\n        }\n        if (this._sendQueue[0].command !== command) {\n            console.warn(`Strange Response: expected ${prettyHex([this._sendQueue[0].command])}, but got ${prettyHex([command])}...`);\n            return continueProcessing();\n        }\n        this._sendQueue[0].addResponse(parameters);\n        return continueProcessing();\n    }\n\n    _processSendQueue() {\n        if (this.state !== SiMainStation.State.Starting && this.state !== SiMainStation.State.Ready) {\n            return setTimeout(() => this._processSendQueue(), 100);\n        }\n        if (this._sendQueue.length === 0 || this._sendQueue[0].state === SendTask.State.SENT) {\n            return null;\n        }\n        var sendTask = this._sendQueue[0];\n\n        // Build command\n        var cmd = buildSiProtoCommand(sendTask);\n\n        // Send command\n        var bstr = String.fromCharCode(proto.WAKEUP) + cmd;\n        var bytes = new Uint8Array(bstr.length);\n        for (let i = 0; i < bstr.length; i++) {\n            bytes[i] = bstr.charCodeAt(i);\n        }\n        this.device.driver.send(this, bytes.buffer)\n            .then(() => {\n                console.debug(`=> (${this.device.driver.name})\\n${prettyHex(bstr, 16)}`);\n                if (sendTask.numResponses <= 0) {\n                    sendTask.succeed();\n                }\n            })\n            .catch((err) => {\n                console.warn(err);\n                sendTask.fail();\n            });\n        sendTask.state = SendTask.State.SENT;\n        return null;\n    }\n\n    sendMessage(message) {\n        const {command, parameters} = message;\n        this._sendCommand(command, parameters, 0);\n    }\n\n    _sendCommand(command, parameters, numRespArg, timeoutArg) {\n        return new Promise((resolve, reject) => {\n            const numResponses = numRespArg ? numRespArg : 0;\n            const timeout = timeoutArg ? timeoutArg : 10;\n\n            const sendTask = new SendTask(\n                command,\n                parameters,\n                numResponses,\n                (resolvedTask) => {\n                    const shifted = this._sendQueue.shift();\n                    if (resolvedTask !== shifted) {\n                        throw new Error('Resolved unexecuting SendTask');\n                    }\n                    setTimeout(() => this._processSendQueue(), 1);\n                    resolve(resolvedTask.responses);\n                },\n                (rejectedTask) => {\n                    const shifted = this._sendQueue.shift();\n                    if (rejectedTask !== shifted) {\n                        throw new Error('Rejected unexecuting SendTask');\n                    }\n                    setTimeout(() => this._processSendQueue(), 1);\n                    reject(new Error('Rejection'));\n                },\n                timeout,\n            );\n            this._sendQueue.push(sendTask);\n            this._processSendQueue();\n        });\n    }\n\n    _remove() {\n        if (0 < this._sendQueue.length && this._sendQueue[0].state !== -1) {\n            clearTimeout(this._sendQueue[0].timeoutTimer);\n        }\n        clearTimeout(this._deviceOpenTimer);\n        delete SiMainStation.allByDevice[this.device.ident];\n        try {\n            SiMainStation.onRemoved(this);\n        } catch (err) {\n            // ignore\n        }\n        try {\n            this.onRemoved();\n        } catch (err) {\n            // ignore\n        }\n    }\n}\n\nSiMainStation.State = { // TODO: maybe include instructions in description?\n    Closed: 0,\n    Opening: 1,\n    Starting: 2,\n    Ready: 3,\n};\n\nSiMainStation.drivers = {};\nSiMainStation.allByDevice = {};\nSiMainStation.all = () => {\n    var arr = [];\n    Object.keys(SiMainStation.allByDevice).map((deviceIdent) => {\n        arr.push(SiMainStation.allByDevice[deviceIdent]);\n    });\n    return arr;\n};\nSiMainStation.startDeviceDetection = () => {\n    var runDeviceDetection = () => {\n        Object.keys(SiMainStation.drivers).map((k) => {\n            try {\n                var driver = new SiMainStation.drivers[k]();\n                if (driver && driver.name && driver.detect && driver.send && driver.open && driver.close) {\n                    driver.detect(SiMainStation);\n                } else {\n                    console.warn('Not a driver:', k);\n                }\n            } catch (err) {\n                console.warn('Error in device detection:', err);\n            }\n        });\n        if (SiMainStation.detectionTimeout) { clearTimeout(SiMainStation.detectionTimeout); }\n        SiMainStation.detectionTimeout = setTimeout(runDeviceDetection, 1000);\n    };\n    runDeviceDetection();\n};\nSiMainStation.newDevice = () => {\n    Object.keys(SiMainStation.drivers).map((k) => {\n        try {\n            var driver = new SiMainStation.drivers[k]();\n            if (driver && driver.name && driver.detect && driver.send && driver.open && driver.close) {\n                driver.new(SiMainStation);\n            } else {\n                console.warn('Not a driver:', k);\n            }\n        } catch (err) {\n            console.warn('Error in device detection:', err);\n        }\n    });\n};\nSiMainStation.onAdded = (_ms) => undefined;\nSiMainStation.onRemoved = (_ms) => undefined;\n","import {arr2big, arr2date, date2arr, timeoutResolvePromise, getLookup} from './utils';\nimport {proto} from './constants';\n\nexport class SiStation {\n    constructor(mainStation) {\n        this.mainStation = mainStation;\n        this._info = {};\n        this._infoTime = 0;\n        this._infoSubscribers = [];\n    }\n\n    static get modeByValue() {\n        return getLookup(this.Mode, (value) => [value.val]);\n    }\n\n    static get typeByValue() {\n        return getLookup(this.Type, (value) => [value.val]);\n    }\n\n    static get modelByValue() {\n        return getLookup(this.Model, (value) => value.vals);\n    }\n\n    readInfo() {\n        var now = new Date().getTime();\n        if (now < this._infoTime + 60000) {\n            return timeoutResolvePromise(this._info);\n        }\n        if (0 < this._infoSubscribers.length) {\n            return new Promise((resolve, reject) => {\n                this._infoSubscribers.push({resolve: resolve, reject: reject});\n            });\n        }\n        return this.forceReadInfo();\n    }\n\n    forceReadInfo() {\n        return this.mainStation._sendCommand(proto.cmd.GET_SYS_VAL, [0x00, 0x80], 1)\n            .then((d) => {\n                const data = d[0];\n                data.splice(0, 3);\n                this._infoTime = new Date().getTime();\n                this._info = {};\n                this._info._raw = data;\n                this._info.refreshRate = data[0x10]; // in 3/sec\n                this._info.powerMode = data[0x11]; // 06 low power, 08 standard/sprint\n                this._info.interval = arr2big(data.slice(0x48, 0x4A));\n                this._info.wtf = arr2big(data.slice(0x4A, 0x4C));\n                this._info.program = data[0x70];\n                this._info.handshake = ((data[0x74] >> 2) & 0x01);\n                this._info.sprint4ms = ((data[0x74] >> 3) & 0x01);\n                this._info.passwordOnly = ((data[0x74] >> 4) & 0x01);\n                this._info.stopOnFullBackup = ((data[0x74] >> 5) & 0x01);\n                this._info.autoReadout = ((data[0x74] >> 7) & 0x01);\n                this._infoSubscribers.map((infoSubscriber) => setTimeout(() => infoSubscriber.resolve(this._info), 1));\n                this._infoSubscribers = [];\n                console.log('INFO READ', this._info);\n                return this._info;\n            })\n            .catch((_err) => {\n                this._infoSubscribers.map((infoSubscriber) => setTimeout(() => infoSubscriber.reject(), 1));\n                this._infoSubscribers = [];\n                throw new Error('READ INFO');\n            });\n    }\n\n    time(newTime) {\n        if (newTime === undefined) {\n            return this.mainStation._sendCommand(proto.cmd.GET_TIME, [], 1)\n                .then((d) => arr2date(d[0].slice(2)));\n        }\n        // TODO: compensate for waiting time\n        const params = date2arr(newTime);\n        return this.mainStation._sendCommand(proto.cmd.SET_TIME, params, 1)\n            .then((d) => arr2date(d[0].slice(2)));\n\n    }\n\n    signal(countArg) {\n        const count = !countArg || countArg < 1 ? 1 : countArg;\n        return this.mainStation._sendCommand(proto.cmd.SIGNAL, [count], 1)\n            .then((data) => {\n                if (data[0][2] !== count) {\n                    throw new Error('NUM BEEPS');\n                }\n            });\n    }\n\n    powerOff() { // Does not power off BSM8 (USB powered), though\n        return this.mainStation._sendCommand(proto.cmd.OFF, [], 0);\n    }\n\n    info(retrieveFunc, paramsFunc = undefined, newValue = undefined) {\n        if (newValue === undefined) {\n            return this.readInfo()\n                .then((info) => retrieveFunc(info._raw));\n        }\n        let params = undefined;\n        return this.readInfo()\n            .then((info) => {\n                params = paramsFunc(info._raw);\n                if (!params) {\n                    throw new Error('INVALID_PARAM');\n                }\n                return this.mainStation._sendCommand(proto.cmd.SET_SYS_VAL, params, 1);\n            })\n            .then((d) => {\n                const data = d[0];\n                data.splice(0, 2);\n                if (data[0] !== params[0]) {\n                    throw new Error('SET_CODE_RESP_ERR');\n                }\n                return this.forceReadInfo();\n            })\n            .then((info) => retrieveFunc(info._raw));\n    }\n\n    // TODO: program (0x70)\n\n    code(newCode) {\n        return this.info(\n            (data) => data[0x72] + ((data[0x73] & 0xC0) << 2),\n            (data) => [0x72, newCode & 0xFF, ((newCode & 0x0300) >> 2) + (data[0x73] & 0x3F)],\n            newCode,\n        );\n    }\n\n    mode(newMode) {\n        return this.info(\n            (data) => this.constructor.modeByValue[data[0x71]],\n            () => {\n                const newModeVal = newMode.hasOwnProperty('val') ? newMode.val : newMode;\n                if (this.constructor.modeByValue[newModeVal] === undefined) {\n                    return false;\n                }\n                return [0x71, newModeVal];\n            },\n            newMode,\n        );\n    }\n\n    beeps(newBeeps) {\n        return this.info(\n            (data) => ((data[0x73] >> 2) & 0x01),\n            (data) => [0x73, (newBeeps ? 0x04 : 0x00) + (data[0x73] & 0xFB)],\n            newBeeps,\n        );\n    }\n\n    flashes(newFlashes) {\n        return this.info(\n            (data) => (data[0x73] & 0x01),\n            (data) => [0x73, (newFlashes ? 0x01 : 0x00) + (data[0x73] & 0xFE)],\n            newFlashes,\n        );\n    }\n\n    autoSend(newAutoSend) {\n        return this.info(\n            (data) => ((data[0x74] >> 1) & 0x01),\n            (data) => [0x74, (newAutoSend ? 0x02 : 0x00) + (data[0x74] & 0xFD)],\n            newAutoSend,\n        );\n    }\n\n    extendedProtocol(newExtendedProtocol) {\n        return this.info(\n            (data) => (data[0x74] & 0x01),\n            (data) => [0x74, (newExtendedProtocol ? 0x01 : 0x00) + (data[0x74] & 0xFE)],\n            newExtendedProtocol,\n        );\n    }\n\n    serialNumber() {\n        return this.info((data) => arr2big(data.slice(0x00, 0x04)));\n    }\n\n    firmwareVersion() {\n        return this.info((data) => arr2big(data.slice(0x05, 0x08)));\n    }\n\n    buildDate() {\n        return this.info((data) => arr2date(data.slice(0x08, 0x0B)));\n    }\n\n    deviceModel() {\n        return this.info((data) => this.constructor.modelByValue[arr2big(data.slice(0x0B, 0x0D))]);\n    }\n\n    memorySize() {\n        return this.info((data) => arr2big(data.slice(0x0D, 0x0E)));\n    }\n\n    batteryDate() {\n        return this.info((data) => arr2date(data.slice(0x15, 0x18)));\n    }\n\n    batteryCapacity() {\n        return this.info((data) => arr2big(data.slice(0x19, 0x1B)));\n    }\n\n    backupPointer() {\n        return this.info((data) => arr2big(data.slice(0x1C, 0x1E).concat(data.slice(0x21, 0x23))));\n    }\n\n    siCard6Mode() {\n        return this.info((data) => arr2big(data.slice(0x33, 0x34)));\n    }\n\n    memoryOverflow() {\n        return this.info((data) => arr2big(data.slice(0x3D, 0x3E)));\n    }\n\n    lastWriteDate() {\n        return this.info((data) => arr2date(data.slice(0x75, 0x7B)));\n    }\n\n    autoOffTimeout() {\n        return this.info((data) => arr2big(data.slice(0x7E, 0x80)));\n    }\n}\n\nSiStation.Mode = {\n    SIACSpecialFunction1: {val: 0x01},\n    Control: {val: 0x02},\n    Start: {val: 0x03},\n    Finish: {val: 0x04},\n    Readout: {val: 0x05},\n    Clear: {val: 0x07},\n    Check: {val: 0x0A},\n    Print: {val: 0x0B},\n    StartWithTimeTrigger: {val: 0x0C},\n    FinishWithTimeTrigger: {val: 0x0D},\n    BCControl: {val: 0x12},\n    BCStart: {val: 0x13},\n    BCFinish: {val: 0x14},\n    BCSlave: {val: 0x1F},\n};\n\nSiStation.Type = {\n    Main: {val: 0x00},\n    Sprint: {val: 0x01},\n    Print: {val: 0x02},\n    Field: {val: 0x03},\n    Master: {val: 0x04},\n};\n\nSiStation.Model = {\n    BSF3: {vals: [0x8003], description: 'BSF3', type: SiStation.Type.Field, series: 3},\n    BSF4: {vals: [0x8004], description: 'BSF4', type: SiStation.Type.Field, series: 4},\n    BSF5: {vals: [0x8115], description: 'BSF5', type: SiStation.Type.Field, series: 5},\n    BSF6: {vals: [0x8146], description: 'BSF6', type: SiStation.Type.Field, series: 6},\n    BSF7: {vals: [0x8117, 0x8197], description: 'BSF7', type: SiStation.Type.Field, series: 7},\n    BSF8: {vals: [0x8118, 0x8198], description: 'BSF8', type: SiStation.Type.Field, series: 8},\n    BS7Master: {vals: [0x8187], description: 'BS7-Master', type: SiStation.Type.Master, series: 7},\n    BS8Master: {vals: [0x8188], description: 'BS8-Master', type: SiStation.Type.Master, series: 8},\n    BSM4: {vals: [0x8084], description: 'BSM4', type: SiStation.Type.Main, series: 4},\n    BSM6: {vals: [0x8086], description: 'BSM6', type: SiStation.Type.Main, series: 6},\n    BSM7: {vals: [0x9197], description: 'BSM7', type: SiStation.Type.Main, series: 7},\n    BSM8: {vals: [0x9198], description: 'BSM8', type: SiStation.Type.Main, series: 8},\n    BS7S: {vals: [0x9597], description: 'BS7-S', type: SiStation.Type.Sprint, series: 7},\n    BS7P: {vals: [0xB197], description: 'BS7-P', type: SiStation.Type.Print, series: 7},\n    BS7GSM: {vals: [0xB897], description: 'BS7-GSM', type: SiStation.Type.Field, series: 7},\n    BS8P: {vals: [0xB198], description: 'BS8-P', type: SiStation.Type.Print, series: 8},\n};\n","import {getLookup} from './utils';\n\nexport const proto = {\n    // Protocol characters\n    STX: 0x02,\n    ETX: 0x03,\n    ACK: 0x06, // when sent to BSx3..6, causes beep until SI-card taken out\n    NAK: 0x15,\n    DLE: 0x10,\n    WAKEUP: 0xFF,\n\n    // Basic protocol commands, currently unused\n    basicCmd: {\n        SET_CARDNO: 0x30,\n        GET_SI5: 0x31, // read out SI-card 5 data\n        SI5_WRITE: 0x43, // 02 43 (block: 0x30 to 0x37) (16 bytes) 03\n        SI5_DET: 0x46, // SI-card 5 inserted (46 49) or removed (46 4F)\n        TRANS_REC: 0x53, // autosend timestamp (online control)\n        TRANS_TIME: 0x54, // autosend timestamp (lightbeam trigger)\n        GET_SI6: 0x61, // read out SI-card 6 data\n        SI6_DET: 0x66, // SI-card 6 inserted\n        SET_MS: 0x70, // \\x4D=\"M\"aster, \\x53=\"S\"lave\n        GET_MS: 0x71,\n        SET_SYS_VAL: 0x72,\n        GET_SYS_VAL: 0x73,\n        GET_BDATA: 0x74, // Note: response carries '\\xC4'!\n        ERASE_BDATA: 0x75,\n        SET_TIME: 0x76,\n        GET_TIME: 0x77,\n        OFF: 0x78,\n        GET_BDATA2: 0x7A, // Note: response carries '\\xCA'!\n        SET_BAUD: 0x7E, // 0=4800 baud, 1=38400 baud\n    },\n    get basicCmdLookup() {\n        return getLookup(proto.basicCmd, (value) => [value]);\n    },\n\n    // Extended protocol commands\n    cmd: {\n        GET_BACKUP: 0x81,\n        SET_SYS_VAL: 0x82,\n        GET_SYS_VAL: 0x83,\n        SRR_WRITE: 0xA2, // ShortRangeRadio - SysData write\n        SRR_READ: 0xA3, // ShortRangeRadio - SysData read\n        SRR_QUERY: 0xA6, // ShortRangeRadio - network device query\n        SRR_PING: 0xA7, // ShortRangeRadio - heartbeat from linked devices, every 50 seconds\n        SRR_ADHOC: 0xA8, // ShortRangeRadio - ad-hoc message, f.ex. from SI-ActiveCard\n        GET_SI5: 0xB1, // read out SI-card 5 data\n        TRANS_REC: 0xD3, // autosend timestamp (online control)\n        CLEAR_CARD: 0xE0, // found on SI-dev-forum: 02 E0 00 E0 00 03 (http://www.sportident.com/en/forum/8/56#59)\n        GET_SI6: 0xE1, // read out SI-card 6 data block\n        SET_SI6: 0xE2, // write SI-card 6 line (16 bytes)\n        SET_SI6_SPECIAL: 0xE4, // write SI-card 6 special fields (e.g. start number)\n        SI5_DET: 0xE5, // SI-card 5 inserted\n        SI6_DET: 0xE6, // SI-card 6 inserted\n        SI_REM: 0xE7, // SI-card removed\n        SI8_DET: 0xE8, // SI-card 8/9/10/11/p/t inserted\n        SET_SI8: 0xEA, // write SI-card 8/9/10/11/p/t data word\n        GET_SI8: 0xEF, // read out SI-card 8/9/10/11/p/t data block\n        SET_MS: 0xF0, // \\x4D=\"M\"aster, \\x53=\"S\"lave\n        GET_MS: 0xF1,\n        ERASE_BDATA: 0xF5,\n        SET_TIME: 0xF6,\n        GET_TIME: 0xF7,\n        OFF: 0xF8,\n        SIGNAL: 0xF9, // 02 F9 (number of signals) (CRC16) 03\n        SET_BAUD: 0xFE, // \\x00=4800 baud, \\x01=38400 baud\n    },\n    get cmdLookup() {\n        return getLookup(proto.cmd, (value) => [value]);\n    },\n\n    // Protocol Parameters\n    P_MS_DIRECT: 0x4D, // \"M\"aster\n    P_MS_INDIRECT: 0x53, // \"S\"lave\n    P_SI6_CB: 0x08,\n\n    // offsets in system data\n    // currently only O_MODE, O_STATION_CODE and O_PROTO are used\n    sysDataOffset: {\n        OLD_SERIAL: 0x00, // 2 bytes - only up to BSx6, numbers < 65.536\n        OLD_CPU_ID: 0x02, // 2 bytes - only up to BSx6, numbers < 65.536\n        SERIAL_NO: 0x00, // 4 bytes - only after BSx7, numbers > 70.000 (if byte 0x00 > 0, better use OLD offsets)\n        FIRMWARE: 0x05, // 3 bytes\n        BUILD_DATE: 0x08, // 3 bytes - YYMMDD\n        MODEL_ID: 0x0B, // 2 bytes:\n        //   8003: BSF3 (serial numbers > 1.000)\n        //   8004: BSF4 (serial numbers > 10.000)\n        //   8084: BSM4-RS232\n        //   8086: BSM6-RS232 / BSM6-USB\n        //   8146: BSF6 (serial numbers > 30.000)\n        //   8115: BSF5 (serial numbers > 50.000)\n        //   8117 / 8118: BSF7 / BSF8 (serial no. 70.000...70.521, 72.002...72.009)\n        //   8187 / 8188: BS7-SI-Master / BS8-SI-Master\n        //   8197: BSF7 (serial numbers > 71.000, apart from 72.002...72.009)\n        //   8198: BSF8 (serial numbers > 80.000)\n        //   9197 / 9198: BSM7-RS232, BSM7-USB / BSM8-USB, BSM8-SRR\n        //   9199: unknown\n        //   9597: BS7-S\n        //   B197 / B198: BS7-P / BS8-P\n        //   B897: BS7-GSM\n        MEM_SIZE: 0x0D, // 1 byte - in KB\n        REFRESH_RATE: 0x10, // 1 byte - in 3/sec\n        POWER_MODE: 0x11, // 1 byte - 06 low power, 08 standard/sprint\n\n        BAT_DATE: 0x15, // 3 bytes - YYMMDD\n        BAT_CAP: 0x19, // 2 bytes - battery capacity in mAh (as multiples of 14.0625?!)\n        BACKUP_PTR: 0x1C, // 4 bytes - at positions 1C,1D,21,22\n        SI6_CB: 0x33, // 1 byte - bitfield defining which SI Card 6 blocks to read: \\x00=\\xC1=read block0,6,7; \\x08=\\xFF=read all 8 blocks\n        BAT_STATE: 0x34, // 4 bytes - for battery state: 2000mAh: 000000=0%, 6E0000=100%, 1000mAh:000000=0%, 370000=100%\n        MEM_OVERFLOW: 0x3D, // 1 byte - memory overflow if != 0x00\n\n        INTERVAL: 0x48, // 2 bytes - in 32*ms\n        WTF: 0x4A, // 2 bytes - in 32*ms\n\n        PROGRAM: 0x70, // 1 byte - station program: xx0xxxxxb competition, xx1xxxxxb training\n        MODE: 0x71, // 1 byte - see SI station modes below\n        STATION_CODE: 0x72, // 1 byte\n        PROTO: 0x74, // 1 byte - protocol configuration, bit mask value:\n        //   xxxxxxx1b extended protocol\n        //   xxxxxx1xb auto send out\n        //   xxxxx1xxb handshake (only valid for card readout)\n        //   xxxx1xxxb sprint 4ms (only for Start&Finish modes)\n        //   xxx1xxxxb access with password only\n        //   xx1xxxxxb stop, if backup is full (only for Readout mode)\n        //   1xxxxxxxb read out SI-card after punch (only for punch modes;\n        //             depends on bit 2: auto send out or handshake)\n        LAST_WRITE_DATE: 0x75, // 3 bytes - YYMMDD\n        LAST_WRITE_TIME: 0x78, // 3 bytes - 1 byte day (see below), 2 bytes seconds after midnight/midday\n        SLEEP_TIME: 0x7B, // 3 bytes - 1 byte day (see below), 2 bytes seconds after midnight/midday\n        //   xxxxxxx0b - seconds relative to midnight/midday: 0 = am, 1 = pm\n        //   xxxx000xb - day of week: 000 = Sunday, 110 = Saturday\n        //   xx00xxxxb - week counter 0..3, relative to programming date\n        WORKING_TIME: 0x7E, // 2 bytes - big endian number = minutes\n    },\n\n    // SI station modes\n    M_CONTROL: 0x02,\n    M_START: 0x03,\n    M_FINISH: 0x04,\n    M_READ_SICARDS: 0x05,\n    M_CLEAR: 0x07,\n    M_CHECK: 0x0A,\n    M_PRINTOUT: 0x0B,\n\n    // Weekday encoding (only for reference, currently unused)\n    D_SUNDAY: 0b000,\n    D_MONDAY: 0b001,\n    D_TUESDAY: 0b010,\n    D_WEDNESDAY: 0b011,\n    D_THURSDAY: 0b100,\n    D_FRIDAY: 0b101,\n    D_SATURDAY: 0b110,\n\n    // Backup memory record length\n    REC_LEN: 8, // Only in extended protocol, otherwise 6!\n\n    // punch trigger in control mode data structure\n    T_OFFSET: 8,\n    T_CN: 0,\n    T_TIME: 5,\n\n    // backup memory in control mode\n    BC_CN: 3,\n    BC_TIME: 8,\n};\n","export class BaseDriver {\n    get name() {\n        throw new Error('Driver must implement name getter');\n    }\n\n    new(_MainStation) {\n        throw new Error('Driver must implement \"new\" method');\n    }\n\n    detect(_MainStation) {\n        throw new Error('Driver must implement \"detect\" method');\n    }\n\n    open(_mainStation) {\n        throw new Error('Driver must implement \"open\" method');\n    }\n\n    close(_mainStation) {\n        throw new Error('Driver must implement \"close\" method');\n    }\n\n    send(_mainStation, _buffer) {\n        throw new Error('Driver must implement \"send\" method');\n    }\n}\n","import {BaseDriver} from './BaseDriver';\n\nconst siConfiguration = 1;\nconst siInterface = 0;\nconst siAlternate = 0;\nconst siEndpoint = 1;\nconst siPacketSize = 64;\nconst siDeviceFilters = [\n    {vendorId: 0x10c4, productId: 0x800a},\n];\n\n\nexport class WebUsb extends BaseDriver {\n    get name() {\n        return 'WebUSB';\n    }\n\n    new(MainStation) {\n        if (!('usb' in navigator)) {\n            return;\n        }\n        navigator.usb.requestDevice({\n            filters: siDeviceFilters,\n        })\n            .then((selectedDevice) => {\n                if (!(`USB-${selectedDevice.serialNumber}` in MainStation.allByDevice)) {\n                    new MainStation({\n                        ident: `USB-${selectedDevice.serialNumber}`,\n                        name: selectedDevice.productName,\n                        driver: this,\n                        _device: selectedDevice,\n                    });\n                }\n            });\n    }\n\n    detect(MainStation) {\n        if (!('usb' in navigator)) {\n            return;\n        }\n        navigator.usb.getDevices().then((devices) => {\n            devices.map((device) => {\n                const matchesSiDeviceFilter = siDeviceFilters.findIndex((filter) =>\n                    device.vendorId === filter.vendorId && device.productId === filter.productId) !== -1;\n                if (matchesSiDeviceFilter) {\n                    if (!(`USB-${device.serialNumber}` in MainStation.allByDevice)) {\n                        new MainStation({\n                            ident: `USB-${device.serialNumber}`,\n                            name: device.productName,\n                            driver: this,\n                            _device: device,\n                        });\n                    }\n                }\n            });\n        });\n    }\n\n    open(mainStation) {\n        return new Promise((resolve, _reject) => {\n            const dev = mainStation.device._device;\n\n            mainStation.device._receiveLoop = () => {\n                dev.transferIn(siEndpoint, siPacketSize)\n                    .then((response) => {\n                        mainStation.device._receiveLoop();\n                        var bufView = new Uint8Array(response.data.buffer);\n                        mainStation._logReceive(bufView);\n                        for (var i = 0; i < bufView.length; i++) {\n                            mainStation._respBuffer.push(bufView[i]);\n                        }\n                        mainStation._processReceiveBuffer();\n                    })\n                    .catch((err) => {\n                        console.warn(err);\n                        mainStation._remove();\n                    });\n            };\n\n            console.debug('Opening...', mainStation.device);\n            dev.open()\n                .then(() => {\n                    console.debug('Resetting...', dev);\n                    return dev.reset();\n                })\n                .then(() => {\n                    console.debug('Selecting Configuration...', dev);\n                    return dev.selectConfiguration(siConfiguration);\n                })\n                .then(() => {\n                    console.debug('Claiming Interface...', dev);\n                    return dev.claimInterface(siInterface);\n                })\n                .then(() => {\n                    console.debug('Selection Alternate Interface...', dev);\n                    return dev.selectAlternateInterface(siInterface, siAlternate);\n                })\n                .then(() => {\n                    console.debug('Enabling Serial...');\n                    return dev.controlTransferOut({\n                        requestType: 'vendor',\n                        recipient: 'interface',\n                        request: 0x00,\n                        value: 0x01,\n                        index: siInterface,\n                    });\n                })\n                .then(() => {\n                    console.debug('Setting Baudrate...');\n                    return dev.controlTransferOut({\n                        requestType: 'vendor',\n                        recipient: 'interface',\n                        request: 0x1E,\n                        value: 0x00,\n                        index: siInterface,\n                    }, new Uint8Array([0x00, 0x96, 0x00, 0x00]).buffer);\n                })\n                .then(() => {\n                    console.debug('Starting Receive Loop...');\n                    mainStation.device._receiveLoop();\n                    resolve();\n                });\n        });\n    }\n\n    close(mainStation) {\n        return new Promise((resolve, _reject) => {\n            const dev = mainStation.device._device;\n            console.debug('Disabling Serial...');\n            dev.controlTransferOut({\n                requestType: 'vendor',\n                recipient: 'interface',\n                request: 0x00,\n                value: 0x00,\n                index: siInterface,\n            })\n                .then(() => {\n                    console.debug('Releasing Interface...');\n                    return dev.releaseInterface(siInterface);\n                })\n                .then(() => {\n                    console.debug('Closing Device...');\n                    return dev.close();\n                })\n                .then(() => {\n                    resolve();\n                });\n        });\n    }\n\n    send(mainStation, buffer) {\n        const dev = mainStation.device._device;\n        return dev.transferOut(siEndpoint, buffer);\n    }\n}\n\nexport default WebUsb;\n","export {default as WebUsb} from './WebUsb';\n","/* global si */\n/* exported si */\n\nimport * as constants from './constants';\nimport * as drivers from './drivers';\nimport * as utils from './utils';\nimport {SiCard} from './SiCard';\nimport {SiStation} from './SiStation';\nimport {SiMainStation} from './SiMainStation';\n\nexport const si = {\n    constants: constants,\n    drivers: drivers,\n    utils: utils,\n    Station: SiStation,\n    MainStation: SiMainStation,\n    Card: SiCard,\n    onLoad: () => undefined,\n};\n\nwindow.addEventListener('load', () => {\n    SiMainStation.startDeviceDetection();\n    if (si.onLoad) {\n        si.onLoad();\n    }\n}, true);\n\nexport default si;\n\nwindow.si = si;\n","import {proto} from './constants';\n\nexport const iterable2arr = (iterable) => [].slice.call(iterable);\n\nexport const isByte = (byte) => (\n    Number(byte) === byte &&\n    Math.floor(byte) === byte &&\n    byte <= 0xFF &&\n    byte >= 0x00\n);\n\nexport const isByteArr = (arr) => (\n    Array.isArray(arr) &&\n    arr.filter((e) => !isByte(e)).length === 0\n);\n\nexport const assertIsByteArr = (arr) => {\n    if (!isByteArr(arr)) {\n        throw new Error(`${arr} is not a byte array`);\n    }\n};\n\nexport const isArrOfLengths = (arr, lengths) => {\n    const actualLength = arr.length;\n    return lengths.filter((length) => actualLength === length) > 0;\n};\n\nexport const assertArrIsOfLengths = (arr, lengths) => {\n    if (!isArrOfLengths(arr, lengths)) {\n        throw new Error(`${arr} is not of lengths ${lengths}`);\n    }\n};\n\nexport const arr2big = (arr) => {\n    assertIsByteArr(arr);\n    var outnum = 0;\n    for (var i = 0; i < arr.length; i++) {\n        const byte = arr[i];\n        outnum += byte * Math.pow(0x100, arr.length - i - 1);\n    }\n    return outnum;\n};\n\nexport const arr2time = (arr) => {\n    assertIsByteArr(arr);\n    assertArrIsOfLengths(arr, [2]);\n    if (arr[0] === 0xEE && arr[1] === 0xEE) {\n        return null;\n    }\n    return arr2big(arr);\n};\n\nexport const arr2date = (arr, asOf = null) => {\n    assertIsByteArr(arr);\n    assertArrIsOfLengths(arr, [3, 6, 7]);\n    if (arr[0] > 99) {\n        throw new Error('Invalid year');\n    }\n    const maxYear = asOf ? asOf.getUTCFullYear() : new Date().getUTCFullYear();\n    const getYear = (lastTwoDigits) => {\n        const maxLastTwo = (maxYear % 100);\n        const maxRest = maxYear - maxLastTwo;\n        if (lastTwoDigits <= maxLastTwo) {\n            return lastTwoDigits + maxRest;\n        }\n        return lastTwoDigits + maxRest - 100;\n    };\n    const utcYear = getYear(arr[0]);\n    const utcMonth = arr[1] - 1;\n    const utcDate = arr[2];\n    const secs = arr.length < 6 ? 0 : arr2big(arr.slice(4, 6));\n    const utcHours = arr.length < 6 ? 0 : (arr[3] & 0x01) * 12 + Math.floor(secs / 3600);\n    const utcMinutes = arr.length < 6 ? 0 : Math.floor((secs % 3600) / 60);\n    const utcSeconds = arr.length < 6 ? 0 : secs % 60;\n    const utcMilliseconds = arr.length < 7 ? 0 : arr[6] * 1000 / 256;\n    const date = new Date(Date.UTC(utcYear, utcMonth, utcDate, utcHours, utcMinutes, utcSeconds, utcMilliseconds));\n    const isValidDate = (\n        date.getUTCFullYear() === utcYear\n        && date.getUTCMonth() === utcMonth\n        && date.getUTCDate() === utcDate\n        && date.getUTCHours() === utcHours\n        && date.getUTCMinutes() === utcMinutes\n        && date.getUTCSeconds() === utcSeconds\n        && date.getUTCMilliseconds() === utcMilliseconds\n    );\n    if (!isValidDate) {\n        throw new Error('invalid date');\n    }\n    return date;\n};\n\nexport const date2arr = (dateTime) => {\n    var secs = (dateTime.getUTCHours() % 12) * 3600 + dateTime.getUTCMinutes() * 60 + dateTime.getUTCSeconds();\n    return [\n        dateTime.getUTCFullYear() % 100,\n        dateTime.getUTCMonth() + 1,\n        dateTime.getUTCDate(),\n        (dateTime.getUTCDay() << 1) + Math.floor(dateTime.getUTCHours() / 12),\n        secs >> 8,\n        secs & 0xFF,\n        Math.floor(dateTime.getUTCMilliseconds() * 256 / 1000),\n    ];\n};\n\nexport const arr2cardNumber = (arr) => {\n    assertIsByteArr(arr);\n    assertArrIsOfLengths(arr, [3, 4]);\n    var cardnum = (arr[1] << 8) | arr[0];\n    var fourthSet = (arr.length === 4 && arr[3] !== 0x00);\n    if (!fourthSet && 1 < arr[2] && arr[2] <= 4) {\n        cardnum += (arr[2] * 100000);\n    } else if (fourthSet || 4 < arr[2]) {\n        cardnum += (arr[2] << 16);\n    }\n    if (arr.length === 4) {\n        cardnum |= (arr[3] << 24);\n    }\n    return cardnum;\n};\n\nexport const prettyHex = (input, lineLength = 0) => {\n    let iterable = input;\n    if (typeof input === 'string') {\n        iterable = [];\n        for (let strIndex = 0; strIndex < input.length; strIndex++) {\n            iterable.push(input.charCodeAt(strIndex));\n        }\n    }\n    const prettyBytes = iterable2arr(iterable)\n        .map((byte) => `00${byte.toString(16)}`)\n        .map((paddedStr) => paddedStr.slice(-2).toUpperCase());\n    if (lineLength === 0) {\n        return prettyBytes.join(' ');\n    }\n    const lines = [];\n    for (let lineIndex = 0; lineIndex < prettyBytes.length / lineLength; lineIndex++) {\n        const startIndex = lineIndex * lineLength;\n        const endIndex = (lineIndex + 1) * lineLength;\n        const line = prettyBytes.slice(startIndex, endIndex).join(' ');\n        lines.push(line);\n    }\n    return lines.join('\\n');\n};\n\nexport const prettyMessage = (message) => {\n    const prettyCommand = `Command: ${proto.cmdLookup[message.command]} ${prettyHex([message.command])} (${message.command})`;\n    const prettyParameters = `Parameters: ${prettyHex(message.parameters)} (${JSON.stringify(message.parameters)})`;\n    return `${prettyCommand}\\n${prettyParameters}`;\n};\n\nexport const unPrettyHex = (input) => {\n    const hexString = input.replace(/\\s/g, '');\n    if ((hexString.length % 2) !== 0) {\n        throw new Error('HEX_STRING_LENGTH_NOT_EVEN');\n    }\n    const byteArray = [];\n    for (let byteIndex = 0; byteIndex < hexString.length / 2; byteIndex++) {\n        const byteValue = parseInt(hexString.substr(byteIndex * 2, 2), 16);\n        byteArray.push(byteValue);\n    }\n    return byteArray;\n};\n\nexport const CRC16 = (str) => {\n    var CRC_POLYNOM = 0x8005;\n    var CRC_BITF = 0x8000;\n    if (str.length < 3) {\n        return [(1 <= str.length ? str[0] : 0x00), (2 <= str.length ? str[1] : 0x00)];\n    }\n    const s = str.length % 2 === 0 ? str.concat([0x00, 0x00]) : str.concat([0x00]);\n    var crc = s[0] * 0x100 + s[1];\n    for (var i = 2; i < s.length; i += 2) {\n        var c = s.slice(i, i + 2);\n        var val = c[0] * 0x100 + c[1];\n        for (var j = 0; j < 16; j++) {\n            if ((crc & CRC_BITF) !== 0) {\n                crc = (crc << 1);\n                if ((val & CRC_BITF) !== 0) {\n                    crc += 1;\n                }\n                crc = (crc ^ CRC_POLYNOM);\n            } else {\n                crc = (crc << 1);\n                if ((val & CRC_BITF) !== 0) {\n                    crc += 1;\n                }\n            }\n            val = (val << 1);\n        }\n        crc = (crc & 0xFFFF);\n    }\n    return [(crc >> 8), (crc & 0xFF)];\n};\n\nexport const getLookup = (mapping, getLookupKeys) => {\n    if (mapping._lookup) {\n        return mapping._lookup;\n    }\n    mapping._lookup = {};\n    Object.keys(mapping)\n        .filter((mappingKey) => mappingKey.substr(0, 1) !== '_')\n        .forEach((mappingKey) => {\n            getLookupKeys(mapping[mappingKey]).forEach((lookupKey) => {\n                mapping._lookup[lookupKey] = mappingKey;\n            });\n        });\n    return mapping._lookup;\n};\n\nexport const processSiProto = (inputData) => {\n    let command, parameters;\n    while (command === undefined) {\n        if (inputData.length === 0) {\n            return null;\n        }\n        if (inputData[0] === proto.ACK) {\n            inputData.splice(0, 1);\n            continue; // eslint-disable-line no-continue\n        }\n        if (inputData[0] === proto.NAK) {\n            inputData.splice(0, 1);\n            return {\n                mode: proto.NAK,\n                command: null,\n                parameters: [],\n            };\n        }\n        if (inputData[0] === proto.WAKEUP) {\n            inputData.splice(0, 1);\n            continue; // eslint-disable-line no-continue\n        }\n        if (inputData[0] !== proto.STX) {\n            console.warn(`Invalid start byte: ${prettyHex([inputData[0]])}`);\n            inputData.splice(0, 1);\n            continue; // eslint-disable-line no-continue\n        }\n        if (inputData.length < 6) {\n            return null;\n        }\n        command = inputData[1];\n        var len = inputData[2];\n        if (inputData.length < 6 + len) {\n            return null;\n        }\n        if (inputData[5 + len] !== proto.ETX) {\n            console.warn(`Invalid end byte: ${prettyHex([inputData[5 + len]])}`);\n            inputData.splice(0, 1);\n            continue; // eslint-disable-line no-continue\n        }\n        parameters = inputData.slice(3, 3 + len);\n        var crcContent = CRC16(inputData.slice(1, 3 + len));\n        var crc = inputData.slice(3 + len, 5 + len);\n        inputData.splice(0, 6 + len);\n        if (crc[0] !== crcContent[0] || crc[1] !== crcContent[1]) {\n            console.debug(`Invalid Command received.\n    CMD:0x${prettyHex([command])}\n    LEN:${len}\n    PARAMS:${prettyHex(parameters)}\n    CRC:${prettyHex(crc)}\n    Content-CRC:${prettyHex(crcContent)}`);\n            continue; // eslint-disable-line no-continue\n        }\n    }\n    return {\n        mode: proto.STX,\n        command: command,\n        parameters: parameters,\n    };\n};\n\nexport const buildSiProtoCommand = (message) => {\n    var commandString = [message.command, message.parameters.length].concat(message.parameters);\n    var crc = CRC16(commandString);\n    var cmd = String.fromCharCode(proto.STX);\n    let i;\n    for (i = 0; i < commandString.length; i++) {\n        cmd += String.fromCharCode(commandString[i]);\n    }\n    for (i = 0; i < crc.length; i++) {\n        cmd += String.fromCharCode(crc[i]);\n    }\n    cmd += String.fromCharCode(proto.ETX);\n    return cmd;\n};\n\nexport const timeoutResolvePromise = (value, timeout = 1) =>\n    new Promise((resolve, _reject) =>\n        setTimeout(() => resolve(value), timeout));\n\nexport const timeoutRejectPromise = (reason, timeout) =>\n    new Promise((resolve, _reject) =>\n        setTimeout(() => resolve(reason), timeout));\n"],"sourceRoot":""}